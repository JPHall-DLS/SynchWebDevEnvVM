- name: Add Apache synchweb directory config to system
  template: src=files/apache2/ispyb2.conf.j2 dest=/etc/httpd/conf.d/ispyb2.conf owner=root group=root mode=0600

- name: Add Apache synchweb directory ssl config to system
  template: src=files/apache2/ssl.conf.j2 dest=/etc/httpd/conf.d/ssl.conf owner=root group=root mode=0600

- name: Check openssl exists
  package: name=openssl state=latest

# CentOS 7 did not symlink the private directory. It does link the certs dir.
# We setup this up to provide a simple location for self-signed certificates
# For production, review these locations so they are consistent.
- name: Check ssl directories exists
  file:
    src: /etc/pki/tls/private
    dest: /etc/ssl/private
    state: link
    owner: root
    group: root

# Might need to specialise this for Debian/CentOS
- name: Generate self-signed certificate
  command: 'openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
-keyout /etc/ssl/private/{{sitename}}.key -out /etc/ssl/certs/{{sitename}}.crt \
-subj "/C=GB/ST=UK/L=Didcot/O=Diamond/OU=Diamond/CN={{sitename}}"'
